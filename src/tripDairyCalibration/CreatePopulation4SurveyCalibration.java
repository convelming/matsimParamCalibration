//package tripDairyCalibration;
//
//import org.locationtech.jts.geom.Coordinate;
//import org.locationtech.jts.geom.GeometryFactory;
//import org.locationtech.jts.geom.Point;
//import org.matsim.api.core.v01.Coord;
//import org.matsim.api.core.v01.Id;
//import org.matsim.api.core.v01.population.*;
//import org.matsim.core.config.ConfigUtils;
//import org.matsim.core.population.PopulationUtils;
//import org.matsim.core.utils.geometry.CoordUtils;
//import population.BuildingUtils;
//import population.actBean.ActNode;
//import population.actBean.ActRootBean;
//import population.actBean.TripLink;
//
//import java.io.BufferedReader;
//import java.io.FileReader;
//import java.util.ArrayList;
//import java.util.List;
//import java.util.Random;
//import java.util.UUID;
//import java.util.concurrent.CopyOnWriteArrayList;
//
//import static population.actBean.GenRandomActChains.getRandomTripLink;
//
///**
// * Author：Milu
// * 严重落后进度啦......
// * date：2023/11/1
// * project:geotools-29.2
// */
//public class CreatePopulation4SurveyCalibration {
//    public static void main(String[] args) throws Exception{
//        //note that all longlats are gcj
//        String odFile = "data/commutingOds.csv";
//        BufferedReader br = new BufferedReader(new FileReader(odFile));
//        String line= br.readLine();
//        List<String> tmpTripStrs = new ArrayList<>();
//        while((line=br.readLine())!=null){
////            String[]  tmp = line.split(",");
//            int count = 1;//Integer.parseInt(tmp[6]);
//            for (int i = 0; i < count; i++) {
//                tmpTripStrs.add(line);
//            }
//        }
//        br.close();
//        System.out.println("there are :"+tmpTripStrs.size()+" trips.");
//        String file = "data/Guangzhou_Buildings_DWG-Polygon4526.shp";
//        BuildingUtils buildingUtils  = new BuildingUtils(file);
//        List<Plan> plans = new CopyOnWriteArrayList<>();
//
//        ActNode actChainsFromSurvey = ActRootBean.getActChains("{\"actNode\": {\"type\": \"home\", \"avgArrivalTime\": 33933.42, \"stdArrivalTime\": 8930.59, \"prob\": 1, \"tripLink\": [{\"avgTravelDistance\": 5470.71, \"stdTravelDistance\": 5990.07, \"mode\": {\"car\": 0.2345, \"bike\": 0.023, \"ebike\": 0.1942, \"taxi\": 0.0058, \"bus\": 0.1424, \"metro\": 0.318, \"walk\": 0.0806, \"other\": 0.0014}, \"actNode\": {\"type\": \"work\", \"avgArrivalTime\": 32682.82, \"stdArrivalTime\": 4790.71, \"duration\": 33596.03, \"durationStd\": 5541.85, \"prob\": 0.6651, \"tripLink\": [{\"avgTravelDistance\": 5738.12, \"stdTravelDistance\": 2686.53, \"mode\": {\"car\": 0.6667, \"bike\": 0.0, \"ebike\": 0.0, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.3333, \"walk\": 0.0, \"other\": 0.0}, \"actNode\": {\"type\": \"work\", \"avgArrivalTime\": 37700.0, \"stdArrivalTime\": 9638.98, \"duration\": 28100.0, \"durationStd\": 10436.95, \"prob\": 0.0043, \"tripLink\": [{\"avgTravelDistance\": 7711.04, \"stdTravelDistance\": 0, \"mode\": {\"car\": 1.0, \"bike\": 0.0, \"ebike\": 0.0, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 0.0, \"other\": 0.0}, \"actNode\": {\"type\": \"work\", \"avgArrivalTime\": 71700.0, \"stdArrivalTime\": 0, \"duration\": 5700.0, \"durationStd\": 0, \"prob\": 0.3333, \"tripLink\": [{\"avgTravelDistance\": 589.33, \"stdTravelDistance\": 0, \"mode\": {\"car\": 1.0, \"bike\": 0.0, \"ebike\": 0.0, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 0.0, \"other\": 0.0}, \"actNode\": {\"type\": \"home\", \"avgArrivalTime\": 77700.0, \"stdArrivalTime\": 0, \"prob\": 1.0}}]}}, {\"avgTravelDistance\": 4581.4, \"stdTravelDistance\": 2067.21, \"mode\": {\"car\": 0.5, \"bike\": 0.5, \"ebike\": 0.0, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 0.0, \"other\": 0.0}, \"actNode\": {\"type\": \"home\", \"avgArrivalTime\": 66150.0, \"stdArrivalTime\": 212.13, \"prob\": 0.6667}}]}}, {\"avgTravelDistance\": 5670.01, \"stdTravelDistance\": 8553.9, \"mode\": {\"car\": 0.3333, \"bike\": 0.0, \"ebike\": 0.3333, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.3333, \"walk\": 0.0, \"other\": 0.0}, \"actNode\": {\"type\": \"leisure\", \"avgArrivalTime\": 64400.0, \"stdArrivalTime\": 1135.78, \"duration\": 12400.0, \"durationStd\": 2913.76, \"prob\": 0.0043, \"tripLink\": [{\"avgTravelDistance\": 3064.87, \"stdTravelDistance\": 4831.06, \"mode\": {\"car\": 0.3333, \"bike\": 0.0, \"ebike\": 0.3333, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.3333, \"walk\": 0.0, \"other\": 0.0}, \"actNode\": {\"type\": \"home\", \"avgArrivalTime\": 77900.0, \"stdArrivalTime\": 1951.92, \"prob\": 1.0}}]}}, {\"avgTravelDistance\": 483.59, \"stdTravelDistance\": 0, \"mode\": {\"car\": 0.0, \"bike\": 0.0, \"ebike\": 1.0, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 0.0, \"other\": 0.0}, \"actNode\": {\"type\": \"pickup\", \"avgArrivalTime\": 58080.0, \"stdArrivalTime\": 0, \"duration\": 420.0, \"durationStd\": 0, \"prob\": 0.0014, \"tripLink\": [{\"avgTravelDistance\": 485.57, \"stdTravelDistance\": 0, \"mode\": {\"car\": 0.0, \"bike\": 0.0, \"ebike\": 1.0, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 0.0, \"other\": 0.0}, \"actNode\": {\"type\": \"work\", \"avgArrivalTime\": 58980.0, \"stdArrivalTime\": 0, \"duration\": 13020.0, \"durationStd\": 0, \"prob\": 1.0, \"tripLink\": [{\"avgTravelDistance\": 277.87, \"stdTravelDistance\": 0, \"mode\": {\"car\": 0.0, \"bike\": 0.0, \"ebike\": 1.0, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 0.0, \"other\": 0.0}, \"actNode\": {\"type\": \"home\", \"avgArrivalTime\": 72600.0, \"stdArrivalTime\": 0, \"prob\": 1.0}}]}}]}}, {\"avgTravelDistance\": 8862.05, \"stdTravelDistance\": 12667.54, \"mode\": {\"car\": 0.6, \"bike\": 0.0, \"ebike\": 0.0, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.4, \"walk\": 0.0, \"other\": 0.0}, \"actNode\": {\"type\": \"affair\", \"avgArrivalTime\": 55380.0, \"stdArrivalTime\": 7110.7, \"duration\": 10500.0, \"durationStd\": 7630.86, \"prob\": 0.0072, \"tripLink\": [{\"avgTravelDistance\": 8295.69, \"stdTravelDistance\": 10333.97, \"mode\": {\"car\": 0.6, \"bike\": 0.0, \"ebike\": 0.0, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.4, \"walk\": 0.0, \"other\": 0.0}, \"actNode\": {\"type\": \"home\", \"avgArrivalTime\": 68460.0, \"stdArrivalTime\": 4441.62, \"prob\": 1.0}}]}}, {\"avgTravelDistance\": 5191.82, \"stdTravelDistance\": 6924.4, \"mode\": {\"car\": 0.1667, \"bike\": 0.0, \"ebike\": 0.3333, \"taxi\": 0.0, \"bus\": 0.1667, \"metro\": 0.1667, \"walk\": 0.1667, \"other\": 0.0}, \"actNode\": {\"type\": \"other\", \"avgArrivalTime\": 61870.0, \"stdArrivalTime\": 3127.7, \"duration\": 3230.0, \"durationStd\": 1860.35, \"prob\": 0.0086, \"tripLink\": [{\"avgTravelDistance\": 516.97, \"stdTravelDistance\": 425.53, \"mode\": {\"car\": 0.1667, \"bike\": 0.0, \"ebike\": 0.3333, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 0.5, \"other\": 0.0}, \"actNode\": {\"type\": \"home\", \"avgArrivalTime\": 65680.0, \"stdArrivalTime\": 2948.36, \"prob\": 1.0}}]}}, {\"avgTravelDistance\": 5433.08, \"stdTravelDistance\": 5845.83, \"mode\": {\"car\": 0.2359, \"bike\": 0.0341, \"ebike\": 0.1825, \"taxi\": 0.0045, \"bus\": 0.1409, \"metro\": 0.319, \"walk\": 0.0816, \"other\": 0.0015}, \"actNode\": {\"type\": \"home\", \"avgArrivalTime\": 68428.58, \"stdArrivalTime\": 5749.97, \"prob\": 0.9698}}, {\"avgTravelDistance\": 6916.09, \"stdTravelDistance\": 10577.76, \"mode\": {\"car\": 0.0, \"bike\": 0.0, \"ebike\": 0.3333, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.3333, \"walk\": 0.3333, \"other\": 0.0}, \"actNode\": {\"type\": \"midhome\", \"avgArrivalTime\": 52600.0, \"stdArrivalTime\": 14722.43, \"duration\": 3800.0, \"durationStd\": 346.41, \"prob\": 0.0043, \"tripLink\": [{\"avgTravelDistance\": 801.91, \"stdTravelDistance\": 225.7, \"mode\": {\"car\": 0.0, \"bike\": 0.0, \"ebike\": 0.5, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 0.5, \"other\": 0.0}, \"actNode\": {\"type\": \"work\", \"avgArrivalTime\": 48600.0, \"stdArrivalTime\": 0.0, \"duration\": 16200.0, \"durationStd\": 0.0, \"prob\": 0.6667, \"tripLink\": [{\"avgTravelDistance\": 647.93, \"stdTravelDistance\": 7.95, \"mode\": {\"car\": 0.0, \"bike\": 0.0, \"ebike\": 0.5, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 0.5, \"other\": 0.0}, \"actNode\": {\"type\": \"home\", \"avgArrivalTime\": 65700.0, \"stdArrivalTime\": 0.0, \"prob\": 1.0}}]}}, {\"avgTravelDistance\": 27733.54, \"stdTravelDistance\": 0, \"mode\": {\"car\": 0.0, \"bike\": 1.0, \"ebike\": 0.0, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 0.0, \"other\": 0.0}, \"actNode\": {\"type\": \"other\", \"avgArrivalTime\": 74400.0, \"stdArrivalTime\": 0, \"duration\": 4800.0, \"durationStd\": 0, \"prob\": 0.3333, \"tripLink\": [{\"avgTravelDistance\": 27733.54, \"stdTravelDistance\": 0, \"mode\": {\"car\": 0.0, \"bike\": 1.0, \"ebike\": 0.0, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 0.0, \"other\": 0.0}, \"actNode\": {\"type\": \"home\", \"avgArrivalTime\": 79500.0, \"stdArrivalTime\": 0, \"prob\": 1.0}}]}}]}}]}}, {\"avgTravelDistance\": 2814.25, \"stdTravelDistance\": 3272.47, \"mode\": {\"car\": 0.0094, \"bike\": 0.1132, \"ebike\": 0.0283, \"taxi\": 0.0094, \"bus\": 0.3208, \"metro\": 0.2075, \"walk\": 0.283, \"other\": 0.0283}, \"actNode\": {\"type\": \"school\", \"avgArrivalTime\": 27314.15, \"stdArrivalTime\": 1931.44, \"duration\": 32958.11, \"durationStd\": 6216.85, \"prob\": 0.1014, \"tripLink\": [{\"avgTravelDistance\": 2783.32, \"stdTravelDistance\": 3249.09, \"mode\": {\"car\": 0.0, \"bike\": 0.1327, \"ebike\": 0.0204, \"taxi\": 0.0, \"bus\": 0.2959, \"metro\": 0.2245, \"walk\": 0.3061, \"other\": 0.0204}, \"actNode\": {\"type\": \"home\", \"avgArrivalTime\": 63415.1, \"stdArrivalTime\": 2613.9, \"prob\": 0.9245}}, {\"avgTravelDistance\": 3189.54, \"stdTravelDistance\": 3777.17, \"mode\": {\"car\": 0.0, \"bike\": 0.0, \"ebike\": 0.0, \"taxi\": 0.0, \"bus\": 0.625, \"metro\": 0.25, \"walk\": 0.0, \"other\": 0.125}, \"actNode\": {\"type\": \"midhome\", \"avgArrivalTime\": 42937.5, \"stdArrivalTime\": 1745.15, \"duration\": 5887.5, \"durationStd\": 1529.18, \"prob\": 0.0755, \"tripLink\": [{\"avgTravelDistance\": 3226.96, \"stdTravelDistance\": 3860.47, \"mode\": {\"car\": 0.0, \"bike\": 0.0, \"ebike\": 0.0, \"taxi\": 0.0, \"bus\": 0.625, \"metro\": 0.25, \"walk\": 0.0, \"other\": 0.125}, \"actNode\": {\"type\": \"school\", \"avgArrivalTime\": 50400.0, \"stdArrivalTime\": 1512.8, \"duration\": 11175.0, \"durationStd\": 985.25, \"prob\": 1.0, \"tripLink\": [{\"avgTravelDistance\": 3239.2, \"stdTravelDistance\": 3859.58, \"mode\": {\"car\": 0.0, \"bike\": 0.0, \"ebike\": 0.0, \"taxi\": 0.0, \"bus\": 0.625, \"metro\": 0.25, \"walk\": 0.0, \"other\": 0.125}, \"actNode\": {\"type\": \"home\", \"avgArrivalTime\": 63112.5, \"stdArrivalTime\": 1495.17, \"prob\": 1.0}}]}}]}}]}}, {\"avgTravelDistance\": 3338.56, \"stdTravelDistance\": 3311.5, \"mode\": {\"car\": 0.0648, \"bike\": 0.0185, \"ebike\": 0.0926, \"taxi\": 0.0648, \"bus\": 0.25, \"metro\": 0.2037, \"walk\": 0.287, \"other\": 0.0185}, \"actNode\": {\"type\": \"leisure\", \"avgArrivalTime\": 44016.11, \"stdArrivalTime\": 15634.71, \"duration\": 13281.11, \"durationStd\": 6965.51, \"prob\": 0.1033, \"tripLink\": [{\"avgTravelDistance\": 116.24, \"stdTravelDistance\": 0, \"mode\": {\"car\": 0.0, \"bike\": 0.0, \"ebike\": 0.0, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 1.0, \"other\": 0.0}, \"actNode\": {\"type\": \"work\", \"avgArrivalTime\": 54000.0, \"stdArrivalTime\": 0, \"duration\": 27000.0, \"durationStd\": 0, \"prob\": 0.0093, \"tripLink\": [{\"avgTravelDistance\": 573.72, \"stdTravelDistance\": 0, \"mode\": {\"car\": 0.0, \"bike\": 0.0, \"ebike\": 0.0, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 1.0, \"other\": 0.0}, \"actNode\": {\"type\": \"home\", \"avgArrivalTime\": 81600.0, \"stdArrivalTime\": 0, \"prob\": 1.0}}]}}, {\"avgTravelDistance\": 909.51, \"stdTravelDistance\": 507.76, \"mode\": {\"car\": 0.0, \"bike\": 0.0, \"ebike\": 0.0, \"taxi\": 0.5, \"bus\": 0.5, \"metro\": 0.0, \"walk\": 0.0, \"other\": 0.0}, \"actNode\": {\"type\": \"leisure\", \"avgArrivalTime\": 53100.0, \"stdArrivalTime\": 12727.92, \"duration\": 5400.0, \"durationStd\": 1272.79, \"prob\": 0.0185, \"tripLink\": [{\"avgTravelDistance\": 3269.56, \"stdTravelDistance\": 90.14, \"mode\": {\"car\": 0.0, \"bike\": 0.0, \"ebike\": 0.0, \"taxi\": 0.5, \"bus\": 0.0, \"metro\": 0.5, \"walk\": 0.0, \"other\": 0.0}, \"actNode\": {\"type\": \"home\", \"avgArrivalTime\": 60000.0, \"stdArrivalTime\": 13576.45, \"prob\": 1.0}}]}}, {\"avgTravelDistance\": 4442.0, \"stdTravelDistance\": 739.7, \"mode\": {\"car\": 0.0, \"bike\": 0.0, \"ebike\": 0.0, \"taxi\": 0.0, \"bus\": 0.5, \"metro\": 0.5, \"walk\": 0.0, \"other\": 0.0}, \"actNode\": {\"type\": \"pickup\", \"avgArrivalTime\": 60300.0, \"stdArrivalTime\": 1272.79, \"duration\": 1950.0, \"durationStd\": 212.13, \"prob\": 0.0185, \"tripLink\": [{\"avgTravelDistance\": 596.43, \"stdTravelDistance\": 330.52, \"mode\": {\"car\": 0.0, \"bike\": 0.0, \"ebike\": 0.0, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 1.0, \"other\": 0.0}, \"actNode\": {\"type\": \"home\", \"avgArrivalTime\": 62850.0, \"stdArrivalTime\": 1060.66, \"prob\": 1.0}}]}}, {\"avgTravelDistance\": 3408.87, \"stdTravelDistance\": 3404.24, \"mode\": {\"car\": 0.0693, \"bike\": 0.0198, \"ebike\": 0.099, \"taxi\": 0.0594, \"bus\": 0.2673, \"metro\": 0.1881, \"walk\": 0.2772, \"other\": 0.0198}, \"actNode\": {\"type\": \"home\", \"avgArrivalTime\": 59462.97, \"stdArrivalTime\": 17593.93, \"prob\": 0.9352}}, {\"avgTravelDistance\": 691.47, \"stdTravelDistance\": 496.45, \"mode\": {\"car\": 0.0, \"bike\": 0.0, \"ebike\": 0.0, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 1.0, \"other\": 0.0}, \"actNode\": {\"type\": \"midhome\", \"avgArrivalTime\": 36000.0, \"stdArrivalTime\": 6363.96, \"duration\": 13500.0, \"durationStd\": 15273.51, \"prob\": 0.0185, \"tripLink\": [{\"avgTravelDistance\": 747.29, \"stdTravelDistance\": 0, \"mode\": {\"car\": 0.0, \"bike\": 0.0, \"ebike\": 0.0, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 1.0, \"other\": 0.0}, \"actNode\": {\"type\": \"leisure\", \"avgArrivalTime\": 65700.0, \"stdArrivalTime\": 0, \"duration\": 4500.0, \"durationStd\": 0, \"prob\": 0.5, \"tripLink\": [{\"avgTravelDistance\": 747.29, \"stdTravelDistance\": 0, \"mode\": {\"car\": 0.0, \"bike\": 0.0, \"ebike\": 0.0, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 1.0, \"other\": 0.0}, \"actNode\": {\"type\": \"home\", \"avgArrivalTime\": 71100.0, \"stdArrivalTime\": 0, \"prob\": 1.0}}]}}, {\"avgTravelDistance\": 804.94, \"stdTravelDistance\": 0, \"mode\": {\"car\": 0.0, \"bike\": 0.0, \"ebike\": 0.0, \"taxi\": 0.0, \"bus\": 1.0, \"metro\": 0.0, \"walk\": 0.0, \"other\": 0.0}, \"actNode\": {\"type\": \"affair\", \"avgArrivalTime\": 36000.0, \"stdArrivalTime\": 0, \"duration\": 10800.0, \"durationStd\": 0, \"prob\": 0.5, \"tripLink\": [{\"avgTravelDistance\": 802.39, \"stdTravelDistance\": 0, \"mode\": {\"car\": 0.0, \"bike\": 0.0, \"ebike\": 0.0, \"taxi\": 0.0, \"bus\": 1.0, \"metro\": 0.0, \"walk\": 0.0, \"other\": 0.0}, \"actNode\": {\"type\": \"home\", \"avgArrivalTime\": 48600.0, \"stdArrivalTime\": 0, \"prob\": 1.0}}]}}]}}]}}, {\"avgTravelDistance\": 705.88, \"stdTravelDistance\": 633.26, \"mode\": {\"car\": 0.0811, \"bike\": 0.0135, \"ebike\": 0.5, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 0.4054, \"other\": 0.0}, \"actNode\": {\"type\": \"pickup\", \"avgArrivalTime\": 32888.11, \"stdArrivalTime\": 12051.19, \"duration\": 2742.97, \"durationStd\": 4021.41, \"prob\": 0.0708, \"tripLink\": [{\"avgTravelDistance\": 1885.53, \"stdTravelDistance\": 1431.14, \"mode\": {\"car\": 0.3333, \"bike\": 0.0, \"ebike\": 0.3333, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.1111, \"walk\": 0.2222, \"other\": 0.0}, \"actNode\": {\"type\": \"work\", \"avgArrivalTime\": 29946.67, \"stdArrivalTime\": 1296.77, \"duration\": 34186.67, \"durationStd\": 1563.68, \"prob\": 0.1216, \"tripLink\": [{\"avgTravelDistance\": 2323.46, \"stdTravelDistance\": 2085.2, \"mode\": {\"car\": 0.3333, \"bike\": 0.0, \"ebike\": 0.3333, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.1111, \"walk\": 0.2222, \"other\": 0.0}, \"actNode\": {\"type\": \"home\", \"avgArrivalTime\": 65100.0, \"stdArrivalTime\": 1290.35, \"prob\": 1.0}}]}}, {\"avgTravelDistance\": 2826.69, \"stdTravelDistance\": 3694.64, \"mode\": {\"car\": 0.25, \"bike\": 0.0, \"ebike\": 0.75, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 0.0, \"other\": 0.0}, \"actNode\": {\"type\": \"leisure\", \"avgArrivalTime\": 28650.0, \"stdArrivalTime\": 866.03, \"duration\": 7350.0, \"durationStd\": 5402.78, \"prob\": 0.0541, \"tripLink\": [{\"avgTravelDistance\": 2475.38, \"stdTravelDistance\": 3619.28, \"mode\": {\"car\": 0.25, \"bike\": 0.0, \"ebike\": 0.75, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 0.0, \"other\": 0.0}, \"actNode\": {\"type\": \"home\", \"avgArrivalTime\": 36570.0, \"stdArrivalTime\": 5768.85, \"prob\": 1.0}}]}}, {\"avgTravelDistance\": 231.47, \"stdTravelDistance\": 0, \"mode\": {\"car\": 0.0, \"bike\": 0.0, \"ebike\": 0.0, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 1.0, \"other\": 0.0}, \"actNode\": {\"type\": \"affair\", \"avgArrivalTime\": 33300.0, \"stdArrivalTime\": 0, \"duration\": 8100.0, \"durationStd\": 0, \"prob\": 0.0135, \"tripLink\": [{\"avgTravelDistance\": 303.12, \"stdTravelDistance\": 0, \"mode\": {\"car\": 0.0, \"bike\": 0.0, \"ebike\": 0.0, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 1.0, \"other\": 0.0}, \"actNode\": {\"type\": \"home\", \"avgArrivalTime\": 42000.0, \"stdArrivalTime\": 0, \"prob\": 1.0}}]}}, {\"avgTravelDistance\": 732.15, \"stdTravelDistance\": 147.94, \"mode\": {\"car\": 0.0, \"bike\": 0.0, \"ebike\": 0.5, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 0.5, \"other\": 0.0}, \"actNode\": {\"type\": \"other\", \"avgArrivalTime\": 29700.0, \"stdArrivalTime\": 2649.53, \"duration\": 4050.0, \"durationStd\": 2056.7, \"prob\": 0.0541, \"tripLink\": [{\"avgTravelDistance\": 953.12, \"stdTravelDistance\": 624.86, \"mode\": {\"car\": 0.0, \"bike\": 0.0, \"ebike\": 0.5, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 0.5, \"other\": 0.0}, \"actNode\": {\"type\": \"home\", \"avgArrivalTime\": 34455.0, \"stdArrivalTime\": 2722.52, \"prob\": 1.0}}]}}, {\"avgTravelDistance\": 685.2, \"stdTravelDistance\": 670.2, \"mode\": {\"car\": 0.0526, \"bike\": 0.0, \"ebike\": 0.4474, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 0.5, \"other\": 0.0}, \"actNode\": {\"type\": \"home\", \"avgArrivalTime\": 42260.53, \"stdArrivalTime\": 14025.84, \"prob\": 0.5135}}, {\"avgTravelDistance\": 604.65, \"stdTravelDistance\": 344.32, \"mode\": {\"car\": 0.0, \"bike\": 0.0, \"ebike\": 0.6111, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 0.3889, \"other\": 0.0}, \"actNode\": {\"type\": \"midhome\", \"avgArrivalTime\": 30586.67, \"stdArrivalTime\": 2635.31, \"duration\": 26780.0, \"durationStd\": 6658.52, \"prob\": 0.2432, \"tripLink\": [{\"avgTravelDistance\": 1244.3, \"stdTravelDistance\": 0, \"mode\": {\"car\": 0.0, \"bike\": 0.0, \"ebike\": 1.0, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 0.0, \"other\": 0.0}, \"actNode\": {\"type\": \"work\", \"avgArrivalTime\": 31800.0, \"stdArrivalTime\": 0, \"duration\": 29700.0, \"durationStd\": 0, \"prob\": 0.0556, \"tripLink\": [{\"avgTravelDistance\": 1274.92, \"stdTravelDistance\": 0, \"mode\": {\"car\": 0.0, \"bike\": 0.0, \"ebike\": 1.0, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 0.0, \"other\": 0.0}, \"actNode\": {\"type\": \"home\", \"avgArrivalTime\": 62100.0, \"stdArrivalTime\": 0, \"prob\": 1.0}}]}}, {\"avgTravelDistance\": 595.46, \"stdTravelDistance\": 352.65, \"mode\": {\"car\": 0.0, \"bike\": 0.0, \"ebike\": 0.5882, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 0.4118, \"other\": 0.0}, \"actNode\": {\"type\": \"pickup\", \"avgArrivalTime\": 59569.41, \"stdArrivalTime\": 1410.04, \"duration\": 998.82, \"durationStd\": 428.45, \"prob\": 0.9444, \"tripLink\": [{\"avgTravelDistance\": 593.83, \"stdTravelDistance\": 350.85, \"mode\": {\"car\": 0.0, \"bike\": 0.0, \"ebike\": 0.5882, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 0.4118, \"other\": 0.0}, \"actNode\": {\"type\": \"home\", \"avgArrivalTime\": 61316.47, \"stdArrivalTime\": 1437.41, \"prob\": 1.0}}]}}]}}]}}, {\"avgTravelDistance\": 7223.07, \"stdTravelDistance\": 5140.87, \"mode\": {\"car\": 0.4651, \"bike\": 0.0, \"ebike\": 0.093, \"taxi\": 0.1163, \"bus\": 0.0698, \"metro\": 0.2558, \"walk\": 0.0, \"other\": 0.0}, \"actNode\": {\"type\": \"affair\", \"avgArrivalTime\": 43297.67, \"stdArrivalTime\": 8526.02, \"duration\": 11267.44, \"durationStd\": 6716.6, \"prob\": 0.0411, \"tripLink\": [{\"avgTravelDistance\": 7180.89, \"stdTravelDistance\": 4732.25, \"mode\": {\"car\": 1.0, \"bike\": 0.0, \"ebike\": 0.0, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 0.0, \"other\": 0.0}, \"actNode\": {\"type\": \"work\", \"avgArrivalTime\": 46425.0, \"stdArrivalTime\": 2083.87, \"duration\": 23025.0, \"durationStd\": 8329.62, \"prob\": 0.093, \"tripLink\": [{\"avgTravelDistance\": 7386.72, \"stdTravelDistance\": 5519.68, \"mode\": {\"car\": 0.75, \"bike\": 0.0, \"ebike\": 0.0, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 0.25, \"other\": 0.0}, \"actNode\": {\"type\": \"home\", \"avgArrivalTime\": 70875.0, \"stdArrivalTime\": 8326.01, \"prob\": 1.0}}]}}, {\"avgTravelDistance\": 1973.35, \"stdTravelDistance\": 226.88, \"mode\": {\"car\": 0.0, \"bike\": 0.0, \"ebike\": 0.0, \"taxi\": 0.5, \"bus\": 0.0, \"metro\": 0.5, \"walk\": 0.0, \"other\": 0.0}, \"actNode\": {\"type\": \"leisure\", \"avgArrivalTime\": 44250.0, \"stdArrivalTime\": 1060.66, \"duration\": 7950.0, \"durationStd\": 1484.92, \"prob\": 0.0465, \"tripLink\": [{\"avgTravelDistance\": 3105.49, \"stdTravelDistance\": 3242.18, \"mode\": {\"car\": 0.0, \"bike\": 0.0, \"ebike\": 0.0, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.5, \"walk\": 0.5, \"other\": 0.0}, \"actNode\": {\"type\": \"home\", \"avgArrivalTime\": 54900.0, \"stdArrivalTime\": 3818.38, \"prob\": 1.0}}]}}, {\"avgTravelDistance\": 7816.63, \"stdTravelDistance\": 4851.1, \"mode\": {\"car\": 0.4444, \"bike\": 0.0, \"ebike\": 0.1111, \"taxi\": 0.0556, \"bus\": 0.1111, \"metro\": 0.2778, \"walk\": 0.0, \"other\": 0.0}, \"actNode\": {\"type\": \"home\", \"avgArrivalTime\": 59025.0, \"stdArrivalTime\": 12274.44, \"prob\": 0.8372}}, {\"avgTravelDistance\": 1027.52, \"stdTravelDistance\": 0, \"mode\": {\"car\": 0.0, \"bike\": 0.0, \"ebike\": 0.0, \"taxi\": 1.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 0.0, \"other\": 0.0}, \"actNode\": {\"type\": \"midhome\", \"avgArrivalTime\": 40200.0, \"stdArrivalTime\": 0, \"duration\": 24900.0, \"durationStd\": 0, \"prob\": 0.0233, \"tripLink\": [{\"avgTravelDistance\": 407.76, \"stdTravelDistance\": 0, \"mode\": {\"car\": 0.0, \"bike\": 0.0, \"ebike\": 0.0, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 1.0, \"other\": 0.0}, \"actNode\": {\"type\": \"leisure\", \"avgArrivalTime\": 65700.0, \"stdArrivalTime\": 0, \"duration\": 6300.0, \"durationStd\": 0, \"prob\": 1.0, \"tripLink\": [{\"avgTravelDistance\": 409.09, \"stdTravelDistance\": 0, \"mode\": {\"car\": 0.0, \"bike\": 0.0, \"ebike\": 0.0, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 1.0, \"other\": 0.0}, \"actNode\": {\"type\": \"home\", \"avgArrivalTime\": 72600.0, \"stdArrivalTime\": 0, \"prob\": 1.0}}]}}]}}]}}, {\"avgTravelDistance\": 3571.31, \"stdTravelDistance\": 7427.18, \"mode\": {\"car\": 0.0526, \"bike\": 0.0, \"ebike\": 0.0526, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.1053, \"walk\": 0.7895, \"other\": 0.0}, \"actNode\": {\"type\": \"other\", \"avgArrivalTime\": 42173.68, \"stdArrivalTime\": 17130.47, \"duration\": 11036.84, \"durationStd\": 9074.46, \"prob\": 0.0182, \"tripLink\": [{\"avgTravelDistance\": 3781.83, \"stdTravelDistance\": 7584.79, \"mode\": {\"car\": 0.0556, \"bike\": 0.0, \"ebike\": 0.0556, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.1111, \"walk\": 0.7778, \"other\": 0.0}, \"actNode\": {\"type\": \"home\", \"avgArrivalTime\": 55333.33, \"stdArrivalTime\": 23295.06, \"prob\": 0.9474}}, {\"avgTravelDistance\": 0.0, \"stdTravelDistance\": 0, \"mode\": {\"car\": 0.0, \"bike\": 0.0, \"ebike\": 0.0, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 1.0, \"other\": 0.0}, \"actNode\": {\"type\": \"midhome\", \"avgArrivalTime\": 36600.0, \"stdArrivalTime\": 0, \"duration\": 24600.0, \"durationStd\": 0, \"prob\": 0.0526, \"tripLink\": [{\"avgTravelDistance\": 0.0, \"stdTravelDistance\": 0, \"mode\": {\"car\": 0.0, \"bike\": 0.0, \"ebike\": 0.0, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 1.0, \"other\": 0.0}, \"actNode\": {\"type\": \"other\", \"avgArrivalTime\": 61800.0, \"stdArrivalTime\": 0, \"duration\": 21000.0, \"durationStd\": 0, \"prob\": 1.0, \"tripLink\": [{\"avgTravelDistance\": 0.0, \"stdTravelDistance\": 0, \"mode\": {\"car\": 0.0, \"bike\": 0.0, \"ebike\": 0.0, \"taxi\": 0.0, \"bus\": 0.0, \"metro\": 0.0, \"walk\": 1.0, \"other\": 0.0}, \"actNode\": {\"type\": \"home\", \"avgArrivalTime\": 83400.0, \"stdArrivalTime\": 0, \"prob\": 1.0}}]}}]}}]}}]}}");
//        int[] count = {0};
//        tmpTripStrs.stream().parallel().forEach(tripStr->{
//            String tmp[] = tripStr.split(",");
//            Coord homeCoord = new Coord(Double.parseDouble(tmp[0]),Double.parseDouble(tmp[1]));
//            Coord workCoord = new Coord(Double.parseDouble(tmp[2]),Double.parseDouble(tmp[3]));
//            try {
////                Person person = population.getFactory().createPerson(Id.createPersonId(UUID.randomUUID().toString()));
//                plans.add(getRandomActChainAndFomuate2Plan(actChainsFromSurvey,homeCoord,workCoord,buildingUtils));
////                population.addPerson(person);
////                plans.add(getRandomActChainAndFomuate2Plan(actChainsFromSurvey,homeCoord,workCoord,buildingUtils));
//            } catch (Exception e) {
//                throw new RuntimeException(e);
//            }
//            count[0]++; if (count[0]%10000==1)System.out.println(count[0]+" is done!");
////            GenRandomActChains.getRandomActChain()
//        });
//
//        Population population = PopulationUtils.createPopulation(ConfigUtils.createConfig());
//        for (int i = 0; i < plans.size(); i++) {
//            Person person = population.getFactory().createPerson(Id.createPersonId(UUID.randomUUID().toString()));
//            person.addPlan(plans.get(i));
//            population.addPerson(person);
//        }
//        new PopulationWriter(population).write("data/synPop231121.xml");
//
//    }
//    public static Plan getRandomActChainAndFomuate2Plan(ActNode actNode, Coord homeCoord, Coord workCoord, BuildingUtils buildingUtils) throws Exception {
//        Plan tmpPlan = PopulationUtils.createPlan();
//        ActNode currentActNode = actNode;
//        Point homePoint = buildingUtils.getNearestBuildingAndCreateRndPointInIt(homeCoord.getX(), homeCoord.getY());
//        Point workPoint = buildingUtils.getNearestBuildingAndCreateRndPointInIt(workCoord.getX(), workCoord.getY());
//        homeCoord = new Coord(homePoint.getX(), homeCoord.getY());
//        workCoord = new Coord(workPoint.getX(), workPoint.getY());
//        actNode.setX(homeCoord.getX()); actNode.setY(homeCoord.getY());
//        Coord lastCoord = homeCoord;
//        double accTime = currentActNode.getAvgArrivalTime()+(2*new Random().nextDouble()-1)*currentActNode.getStdArrivalTime();
//        Activity homeAct = PopulationUtils.createActivityFromCoord("home",homeCoord);
//        homeAct.setEndTime(Math.max(accTime, 7.50*3600));
//        tmpPlan.addActivity(homeAct);
//        //        while(currentActNode.getTripLink().size()>0){
//        while(currentActNode.getTripLink()!=null&&currentActNode.getTripLink().size()>0){
//            TripLink tmpTripLink = getRandomTripLink(currentActNode.getTripLink());
////            double rndTravelDistance = getTravelDistance(tmpTripLink.getAvgTravelDistance(),tmpTripLink.getStdTravelDistance());
//            Leg leg = PopulationUtils.createLeg("car");
//            tmpPlan.addLeg(leg);
//            currentActNode = tmpTripLink.getActNode();
//            if (currentActNode.getType().contains("home")){
//                Activity activity = PopulationUtils.createActivityFromCoord("home", homeCoord);
//                Double distance = CoordUtils.calcEuclideanDistance(homeCoord,lastCoord);
//                lastCoord = homeCoord;
//                accTime += distance/25.0 + (currentActNode.getDuration()+(2*new Random().nextDouble()-1)*currentActNode.getDurationStd());
//                if (currentActNode.getType().equals("midhome")){
//                    activity.setEndTime(Math.min(accTime,23*3600.));
//                }
//                tmpPlan.addActivity(activity);
//            }else {
//                Point tmpDestPoint = null;
//                if (currentActNode.getType().equals("work")){
//                    tmpDestPoint= new GeometryFactory().createPoint(new Coordinate(workCoord.getX(),workCoord.getY()));
//                }else {
//                    tmpDestPoint = buildingUtils.getNearestBuildingInRange(lastCoord.getX(),lastCoord.getY(),3000.,300.);
//                }
//                Double distance = CoordUtils.calcEuclideanDistance(new Coord(tmpDestPoint.getX(),tmpDestPoint.getY()),lastCoord);
//                lastCoord = new Coord(tmpDestPoint.getX(),tmpDestPoint.getY());
//                Activity activity = PopulationUtils.createActivityFromCoord(currentActNode.getType(),lastCoord);
//                accTime += distance/25.0 + (currentActNode.getDuration()+(2*new Random().nextDouble()-1)*currentActNode.getDurationStd());
//                activity.setEndTime(Math.min(accTime,23*3600.));
//                tmpPlan.addActivity(activity);
//            }
//        }
//        return tmpPlan;
//    }
//}
